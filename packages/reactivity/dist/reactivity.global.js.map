{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { effect } from './effect';\nexport { reactive } from './reactive'", "\nexport let activeEffect = undefined;\n\nfunction cleanupEffect(effect) {\n    const { deps } = effect;\n    for(let i = 0; i<deps.length; i++) {\n        deps[i].delete(effect); // \u89E3\u9664effect\uFF0C \u91CD\u65B0\u6536\u96C6\n    }\n    effect.deps.length = 0;\n}\nclass ReactiveEffect {\n    // \u589E\u52A0\u4E00\u4E2A\u7236\u7ED3\u70B9\u6307\u5411\n    public parent = null;\n    public deps = [];\n    // \u5728\u5B9E\u4F8B\u4E0A\u65B0\u589E\u4E00\u4E2Aactive\u5C5E\u6027\n    public active = true ; // \u8FD9\u4E2Aeffect\u9ED8\u8BA4\u662F\u6FC0\u6D3B\u7684\u3002\n    constructor(public fn, public scheduler){}  // ts public \u8868\u793A\u7528\u6237\u4F20\u9012\u7684\u53C2\u6570\u4E5F\u4F1A\u5728this\u4E0A\uFF0C\u76F8\u5F53\u4E8Ethis.fn = fn;\n        \n    run() { // \u5C31\u662F\u6267\u884Ceffect\n        if(!this.active){ // \u975E\u6FC0\u6D3B\u7684\u72B6\u6001\uFF0C\u53EA\u6267\u884C\uFF0C\u4E0D\u9700\u8981\u4F9D\u8D56\u6536\u96C6\n            this.fn()\n        }\n        // \u5176\u4F59\u5C31\u8981\u4F9D\u8D56\u6536\u96C6\u4E86 \u6838\u5FC3\u5C31\u662F\u5F53\u524D\u7684effect \u548C\u7A0D\u540E\u6E32\u67D3\u7684\u5C5E\u6027\u5173\u8054;\n        try{ \n            this.parent = activeEffect;\n            activeEffect = this;\n            // \u8FD9\u91CC\u9700\u8981\u5728\u6267\u884C\u7528\u6237\u51FD\u6570\u4E4B\u524D\uFF0C 1\uFF09\u628A\u4E4B\u524D\u6536\u96C6\u7684\u5185\u5BB9\u6E05\u7A7A\n            cleanupEffect(this);\n            return this.fn(); // 2\uFF09\u518D\u91CD\u65B0\u6536\u96C6\n        } finally{\n            activeEffect = this.parent;\n            this.parent = null;\n        }\n    }\n    stop() {\n        if(this.active) {\n            this.active = false;\n            cleanupEffect(this);\n        }\n    }\n}\n\nexport function effect(fn, options:any = {}) { \n    // \u53EF\u4EE5\u6839\u636E\u72B6\u6001\u53D8\u5316\uFF0C\u91CD\u65B0\u6267\u884C\uFF0C effect\u53EF\u4EE5\u5D4C\u5957\u7740\u5199\n    const  _effect = new ReactiveEffect(fn, options.scheduler);\n    _effect.run();\n    const runner = _effect.run.bind(_effect); // \u7ED1\u5B9Athis\n    runner.effect = _effect; // \u5C06effect \u6302\u8F7D\u5230 runner \u51FD\u6570\u4E0A\n    return runner;\n}\n\n\n// \u6570\u636E\u7ED3\u6784\n/**\n * \u5BF9\u8C61   \u67D0\u4E2A\u5C5E\u6027 -\u300B \u591A\u4E2Aeffect\n * {\u5BF9\u8C61\uFF1A{name: []}}\n * WeakMap = {\u5BF9\u8C61: Map{name: Set}}\n * \n * \u591A\u5BF9\u591A\n * \n */\nconst targetMap = new WeakMap();\nexport function track(target, type, key) {\n    if(!activeEffect) return;\n    let depsMap = targetMap.get(target);\n    if(!depsMap){\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    let dep = depsMap.get(key);\n    if(!dep) {\n        depsMap.set(key, (dep = new Set()))\n    }\n    let shouldTrack = !dep.has(activeEffect); // \u53BB\u91CD\u4E00\u4E0B\n    if(shouldTrack) {\n        dep.add(activeEffect);\n        // \u5B58\u653E\u7684\u662F\u5C5E\u6027\u5BF9\u5E94\u7684set\n        activeEffect.deps.push(dep);// \u591A\u5BF9\u591A\uFF0C\u8BA9effect\u8BB0\u5F55\u5BF9\u5E94\u7684dep\uFF0C \u7A0D\u540E\u6E05\u7406\u65F6\u4F1A\u7528\n    }\n}\n\nexport function trigger(target, type, key, value, oldValue) {\n    const depsMap = targetMap.get(target);\n    if(!depsMap) return;\n    let effects = depsMap.get(key);\n    // \u5728\u6267\u884C\u4E4B\u524D \u5148\u62F7\u8D1D\u4E00\u4EFD\uFF0C\u4E0D\u8981\u5173\u8054\u5F15\u7528\n    if(effects) {\n        effects = new Set(effects);\n        effects.forEach(effect =>{\n            if (effect !== activeEffect) { // \u907F\u514D\u9012\u5F52\uFF0C\u6B7B\u5FAA\u73AF\u7684\u60C5\u51B5\n                if( effect.scheduler ) {\n                    effect.scheduler(); //  1\u3001\u5982\u679C\u7528\u6237\u4F20\u5165\u4E86\uFF0C \u5219\u7528\u7528\u6237\u7684\n                } else {\n                    effect.run(); // 2\u3001\u5426\u5219\u9ED8\u8BA4\u5237\u65B0\u89C6\u56FE\n                }\n                \n            }\n        })\n    }\n    \n\n}\n", "export const isObject = (obj) => {\n    return typeof obj === 'object' && obj !== null;\n}", "import { track, trigger } from './effect'\n\nexport const enum ReactiveFlags {\n    IS_REACTIVE = '__v_isReactive'\n}\n\nexport const mutableHandlers = {\n    get(target, key, receiver) {\n        if(key === ReactiveFlags.IS_REACTIVE) {\n            return true;\n        }\n        // \u6536\u96C6\u4F9D\u8D56\n        track(target, 'get', key);\n        // \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u53D6\u503C\u4E86\n        return Reflect.get(target, key, receiver); // \u6539\u53D8this\u6307\u5411\uFF0C receiver\u662F\u6307proxy\n    },\n    set(target, key, value, receiver) {\n        let oldValue = target[key];\n        let result = Reflect.set(target, key, value, receiver);\n        if(oldValue !== value) { // \u503C\u53D8\u5316\u4E86\uFF0C\u8981\u66F4\u65B0\n            trigger(target, 'set', key, value, oldValue);\n        }\n        // \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u8BBE\u503C\u4E86\n        return result\n    }\n}", "import { isObject } from '@vue/shared';\nimport { mutableHandlers, ReactiveFlags } from './baseHandler'; // \u6838\u5FC3\u62BD\u5230\u8FD9\u91CC\n\n// 1\uFF09\u5C06\u6570\u636E\u8F6C\u6362\u4E3A\u54CD\u5E94\u5F0F\u7684\uFF0C \u53EA\u80FD\u505A\u5BF9\u8C61\u7684\u4EE3\u7406\nconst reactiveMap = new WeakMap(); // WeakMap\u4E2Dkey\u53EA\u80FD\u662F\u5BF9\u8C61\n\n\n// \u540C\u4E00\u4E2A\u5BF9\u8C61\u4EE3\u7406\u591A\u6B21\uFF0C\u8FD4\u56DE\u540C\u4E00\u4E2A\u4EE3\u7406\n// \u4EE3\u7406\u5BF9\u8C61\u518D\u6B21\u88AB\u4EE3\u7406\uFF0C\u53EF\u4EE5\u76F4\u63A5\u8FD4\u56DE\nexport function reactive(target) {\n    if(!isObject(target)) {\n        return\n    }\n    if(target[ReactiveFlags.IS_REACTIVE]){ // \u7B2C\u4E00\u6B21\u4E0D\u662Fproxy\uFF0C \u7B2C\u4E8C\u6B21\u8FDB\u6765\u662Fproxy\uFF0C \u4F1A\u8D70\u5230get\u4E2D\u7684\u5224\u65AD\n        return target;\n    }\n    // \u589E\u52A0\u7F13\u5B58\n    let existingProxy = reactiveMap.get(target);\n    if(existingProxy) {\n        return existingProxy;\n    }\n    // \u7B2C\u4E00\u6B21\u666E\u901A\u5BF9\u8C61\u4EE3\u7406\n    // \u4E0B\u4E00\u6B21\u4F20\u9012\u7684\u662Fproxy\uFF0C \u770B\u6709\u6728\u6709\u4EE3\u7406\u8FC7\uFF0C \u589E\u52A0\u6807\u8BC6\n\n    const proxy = new Proxy(target, mutableHandlers);\n    reactiveMap.set(target, proxy);\n    return proxy;\n}\n\n\n\n"],
  "mappings": "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",
  "names": []
}
